<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Using Generic Cloud Images on a local machine | AlmaLinux Wiki</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="shortcut icon" type="image/png" href="/images/logo.png">
    <meta name="description" content="AlmaLinux OS Documentation">
    
    <link rel="preload" href="/assets/css/0.styles.5d429379.css" as="style"><link rel="preload" href="/assets/js/app.7857f0f2.js" as="script"><link rel="preload" href="/assets/js/2.592a6313.js" as="script"><link rel="preload" href="/assets/js/1.47e12c88.js" as="script"><link rel="preload" href="/assets/js/35.9e9a06e2.js" as="script"><link rel="prefetch" href="/assets/js/10.fde088a2.js"><link rel="prefetch" href="/assets/js/100.dd7da4d8.js"><link rel="prefetch" href="/assets/js/101.20ce7095.js"><link rel="prefetch" href="/assets/js/102.5e07ce71.js"><link rel="prefetch" href="/assets/js/103.468b6bd1.js"><link rel="prefetch" href="/assets/js/104.31f3e622.js"><link rel="prefetch" href="/assets/js/105.c8d1b392.js"><link rel="prefetch" href="/assets/js/106.04395804.js"><link rel="prefetch" href="/assets/js/107.87c28b27.js"><link rel="prefetch" href="/assets/js/108.db0d9c1e.js"><link rel="prefetch" href="/assets/js/109.a5b5c178.js"><link rel="prefetch" href="/assets/js/11.c62b6b34.js"><link rel="prefetch" href="/assets/js/110.4501bde2.js"><link rel="prefetch" href="/assets/js/111.71c6704d.js"><link rel="prefetch" href="/assets/js/112.ca94c220.js"><link rel="prefetch" href="/assets/js/113.04a32358.js"><link rel="prefetch" href="/assets/js/114.df2add4f.js"><link rel="prefetch" href="/assets/js/115.51afa286.js"><link rel="prefetch" href="/assets/js/116.1dd26ce5.js"><link rel="prefetch" href="/assets/js/117.5cc535d7.js"><link rel="prefetch" href="/assets/js/118.a016a4e0.js"><link rel="prefetch" href="/assets/js/119.ddcfc9c9.js"><link rel="prefetch" href="/assets/js/12.27d4f152.js"><link rel="prefetch" href="/assets/js/120.a937c74b.js"><link rel="prefetch" href="/assets/js/121.fb02b181.js"><link rel="prefetch" href="/assets/js/122.f642ac52.js"><link rel="prefetch" href="/assets/js/123.5df6efe8.js"><link rel="prefetch" href="/assets/js/124.ae81be8f.js"><link rel="prefetch" href="/assets/js/125.f4371356.js"><link rel="prefetch" href="/assets/js/126.5c0a274b.js"><link rel="prefetch" href="/assets/js/127.e241072d.js"><link rel="prefetch" href="/assets/js/128.542a8950.js"><link rel="prefetch" href="/assets/js/129.9fc542e7.js"><link rel="prefetch" href="/assets/js/13.419d7748.js"><link rel="prefetch" href="/assets/js/14.eb7a3d07.js"><link rel="prefetch" href="/assets/js/15.114dfd5c.js"><link rel="prefetch" href="/assets/js/16.85253907.js"><link rel="prefetch" href="/assets/js/17.c2838453.js"><link rel="prefetch" href="/assets/js/18.3256f17f.js"><link rel="prefetch" href="/assets/js/19.d8afd0ae.js"><link rel="prefetch" href="/assets/js/20.0d880388.js"><link rel="prefetch" href="/assets/js/21.33b300c9.js"><link rel="prefetch" href="/assets/js/22.4bdb5a83.js"><link rel="prefetch" href="/assets/js/23.d0336626.js"><link rel="prefetch" href="/assets/js/24.bab2df0f.js"><link rel="prefetch" href="/assets/js/25.82d8beb7.js"><link rel="prefetch" href="/assets/js/26.ab1189f7.js"><link rel="prefetch" href="/assets/js/27.3ceb4755.js"><link rel="prefetch" href="/assets/js/28.d4f1892b.js"><link rel="prefetch" href="/assets/js/29.bd5a6e03.js"><link rel="prefetch" href="/assets/js/3.af33e5d6.js"><link rel="prefetch" href="/assets/js/30.b95a0d33.js"><link rel="prefetch" href="/assets/js/31.f65e8c23.js"><link rel="prefetch" href="/assets/js/32.c0dbd3dd.js"><link rel="prefetch" href="/assets/js/33.488fba41.js"><link rel="prefetch" href="/assets/js/34.84ee8902.js"><link rel="prefetch" href="/assets/js/36.a383ce50.js"><link rel="prefetch" href="/assets/js/37.1f36a1b0.js"><link rel="prefetch" href="/assets/js/38.c85f1868.js"><link rel="prefetch" href="/assets/js/39.c781e46f.js"><link rel="prefetch" href="/assets/js/4.0a92875f.js"><link rel="prefetch" href="/assets/js/40.a5cdff80.js"><link rel="prefetch" href="/assets/js/41.74435274.js"><link rel="prefetch" href="/assets/js/42.78a6e7ea.js"><link rel="prefetch" href="/assets/js/43.2e209c33.js"><link rel="prefetch" href="/assets/js/44.367fcb2a.js"><link rel="prefetch" href="/assets/js/45.e13e6886.js"><link rel="prefetch" href="/assets/js/46.fe75aab9.js"><link rel="prefetch" href="/assets/js/47.98c24ad3.js"><link rel="prefetch" href="/assets/js/48.068a6be0.js"><link rel="prefetch" href="/assets/js/49.22fac64a.js"><link rel="prefetch" href="/assets/js/5.3b9be48d.js"><link rel="prefetch" href="/assets/js/50.1022d28b.js"><link rel="prefetch" href="/assets/js/51.b6bc53e3.js"><link rel="prefetch" href="/assets/js/52.94a5b054.js"><link rel="prefetch" href="/assets/js/53.22507c19.js"><link rel="prefetch" href="/assets/js/54.51681889.js"><link rel="prefetch" href="/assets/js/55.bfc3e9cd.js"><link rel="prefetch" href="/assets/js/56.dfdc0bc5.js"><link rel="prefetch" href="/assets/js/57.b6957e70.js"><link rel="prefetch" href="/assets/js/58.ba57c242.js"><link rel="prefetch" href="/assets/js/59.83279f1d.js"><link rel="prefetch" href="/assets/js/6.7b96ebf4.js"><link rel="prefetch" href="/assets/js/60.d3fd7fe4.js"><link rel="prefetch" href="/assets/js/61.892dda89.js"><link rel="prefetch" href="/assets/js/62.b74bdfbf.js"><link rel="prefetch" href="/assets/js/63.7cd9adce.js"><link rel="prefetch" href="/assets/js/64.69ad14b4.js"><link rel="prefetch" href="/assets/js/65.5df1a784.js"><link rel="prefetch" href="/assets/js/66.79a6d7a1.js"><link rel="prefetch" href="/assets/js/67.ffbe749b.js"><link rel="prefetch" href="/assets/js/68.da73ca47.js"><link rel="prefetch" href="/assets/js/69.abd36331.js"><link rel="prefetch" href="/assets/js/7.7e58b9c4.js"><link rel="prefetch" href="/assets/js/70.15bdfa2d.js"><link rel="prefetch" href="/assets/js/71.f61a7f49.js"><link rel="prefetch" href="/assets/js/72.a7a7f5a6.js"><link rel="prefetch" href="/assets/js/73.2f768ba4.js"><link rel="prefetch" href="/assets/js/74.2029787d.js"><link rel="prefetch" href="/assets/js/75.8b84d07d.js"><link rel="prefetch" href="/assets/js/76.ccb046f9.js"><link rel="prefetch" href="/assets/js/77.39ebe5ea.js"><link rel="prefetch" href="/assets/js/78.69b38a23.js"><link rel="prefetch" href="/assets/js/79.dcece00c.js"><link rel="prefetch" href="/assets/js/80.464f3780.js"><link rel="prefetch" href="/assets/js/81.b1ecf8d7.js"><link rel="prefetch" href="/assets/js/82.a2b38358.js"><link rel="prefetch" href="/assets/js/83.39198063.js"><link rel="prefetch" href="/assets/js/84.35825856.js"><link rel="prefetch" href="/assets/js/85.84cf25d2.js"><link rel="prefetch" href="/assets/js/86.5834f629.js"><link rel="prefetch" href="/assets/js/87.da310774.js"><link rel="prefetch" href="/assets/js/88.8a59349e.js"><link rel="prefetch" href="/assets/js/89.cf62e4d4.js"><link rel="prefetch" href="/assets/js/90.db3d160e.js"><link rel="prefetch" href="/assets/js/91.25374ce2.js"><link rel="prefetch" href="/assets/js/92.7113dfcf.js"><link rel="prefetch" href="/assets/js/93.b6dd7410.js"><link rel="prefetch" href="/assets/js/94.b7cd4968.js"><link rel="prefetch" href="/assets/js/95.7e0fee0a.js"><link rel="prefetch" href="/assets/js/96.39eb2eea.js"><link rel="prefetch" href="/assets/js/97.73424fea.js"><link rel="prefetch" href="/assets/js/98.73ffe341.js"><link rel="prefetch" href="/assets/js/99.33e61da8.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2493936b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d429379.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="AlmaLinux Wiki" class="logo"> <span class="site-name can-hide">AlmaLinux Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://lists.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mailing Lists
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://bugs.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bugs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/AlmaLinux/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://chat.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://lists.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Mailing Lists
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://bugs.almalinux.org/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Bugs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/AlmaLinux/" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">About</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Contribute</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Documentation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Installation</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/documentation/installation-guide.html" class="sidebar-link">AlmaLinux Installation Guide</a></li><li><a href="/documentation/after-installation-guide.html" class="sidebar-link">AlmaLinux After-Installation Guide</a></li><li><a href="/documentation/wsl.html" class="sidebar-link">AlmaLinux WSL</a></li><li><a href="/LiveMedia.html" class="sidebar-link">Live Media</a></li><li><a href="/documentation/raspberry-pi.html" class="sidebar-link">Raspberry Pi</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/cloud" class="sidebar-heading clickable router-link-active open"><span>Cloud Images</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/cloud/AWS.html" class="sidebar-link">AWS</a></li><li><a href="/cloud/Azure.html" class="sidebar-link">Azure</a></li><li><a href="/cloud/Generic-cloud.html" class="sidebar-link">Generic Cloud (cloud-init)</a></li><li><a href="/cloud/Generic-cloud-on-local.html" aria-current="page" class="active sidebar-link">Using Generic Cloud Images on a local machine</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#almalinux-guest-os-support" class="sidebar-link">AlmaLinux Guest OS support</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#create-a-snapshot-from-the-image" class="sidebar-link">Create a snapshot from the image</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#cloud-init" class="sidebar-link">Cloud-init</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#static-ip" class="sidebar-link">Static IP</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#virt-manager-gui" class="sidebar-link">Virt-Manager (GUI)</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#repackage-cloud-image" class="sidebar-link">Repackage cloud image</a></li><li class="sidebar-sub-header"><a href="/cloud/Generic-cloud-on-local.html#inspection-and-manipulation-of-images" class="sidebar-link">Inspection and Manipulation of images</a></li></ul></li><li><a href="/cloud/Google.html" class="sidebar-link">Google Cloud</a></li><li><a href="/cloud/OCI.html" class="sidebar-link">Oracle Cloud Infrastructure</a></li><li><a href="/cloud/OpenNebula.html" class="sidebar-link">OpenNebula</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/containers" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/repos/" class="sidebar-heading clickable"><span>Repositories</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Migration</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Foundation</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="using-generic-cloud-images-on-a-local-machine"><a href="#using-generic-cloud-images-on-a-local-machine" class="header-anchor">#</a> Using Generic Cloud Images on a local machine</h1> <p>You can use the AlmaLinux OS 8 and 9 Generic Cloud images for testing, developing, manipulating and repackaging purposes on your local machine.</p> <p>Required packages:</p> <ul><li><code>osinfo-db</code> for AlmaLinux OS support on the virtualization stack.</li> <li><code>qemu-img</code> (RPM) (ArchLinux), <code>qemu-utils</code> (DEB) for creating snapshots.</li> <li><code>virt-install</code> (CLI) <code>virt-manager</code> (GUI) (RPM), <code>virt-manager</code> (ships with <code>virt-install</code> too) (DEB) for creating VMs.</li> <li><code>xorriso</code> or <code>genisoimage</code> for creation of Cloud-init data ISOs.</li> <li><code>guestfs-tools</code> (RPM) (ArchLinux), <code>libguestfs-tools</code> (DEB) for inspecting and manipulating image content.</li></ul> <h2 id="almalinux-guest-os-support"><a href="#almalinux-guest-os-support" class="header-anchor">#</a> AlmaLinux Guest OS support</h2> <p>You need at least version <code>20210215</code> for AlmaLinux and <code>20210426</code> for other distributions <code>osinfo-db</code> packages to support AlmaLinux as a guest OS.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><code>20210621</code> and newer recommended for latest improvements.</p></div> <p>To check whether AlmaLinux OS is supported on the installed version of <code>osinfo-db</code>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>osinfo-query os <span class="token operator">|</span> <span class="token function">grep</span> almalinux

 almalinux8           <span class="token operator">|</span> AlmaLinux <span class="token number">8</span>                                        <span class="token operator">|</span> <span class="token number">8</span>        <span class="token operator">|</span> http://almalinux.org/almalinux/8
 almalinux9           <span class="token operator">|</span> AlmaLinux <span class="token number">9</span>                                        <span class="token operator">|</span> <span class="token number">9</span>        <span class="token operator">|</span> http://almalinux.org/almalinux/9
</code></pre></div><p>If the installed <code>osinfo-db</code> doesn’t support either or any version of AlmaLinux OS, You can manually update the Osinfo database with the <code>--local</code> option without overriding the installed <code>osinfo-db</code> which is installed by the distribution's package manager. The new database will have precedence when the database is loaded.</p> <p>Retrieve the latest <code>$osinfo_db_version</code> from here (e.g., <code>20230719</code>) : <a href="https://releases.pagure.org/libosinfo/?C=M;O=D" target="_blank" rel="noopener noreferrer">https://releases.pagure.org/libosinfo/?C=M;O=D<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token assign-left variable">osinfo_db_version</span><span class="token operator">=</span><span class="token string">'20230719'</span> <span class="token comment"># Replace with the latest version</span>

<span class="token function">curl</span> <span class="token parameter variable">-O</span> https://releases.pagure.org/libosinfo/osinfo-db-<span class="token string">&quot;<span class="token variable">$osinfo_db_version</span>&quot;</span>.tar.xz <span class="token comment"># Download</span>
<span class="token function">sudo</span> osinfo-db-import <span class="token parameter variable">--local</span> osinfo-db-<span class="token string">&quot;<span class="token variable">$osinfo_db_version</span>&quot;</span>.tar.xz <span class="token comment"># Install</span>
</code></pre></div><p>Refer to this guide to download and verify the cloud images: <a href="https://wiki.almalinux.org/cloud/Generic-cloud.html#download-and-verification" target="_blank" rel="noopener noreferrer">https://wiki.almalinux.org/cloud/Generic-cloud.html#download-and-verification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="create-a-snapshot-from-the-image"><a href="#create-a-snapshot-from-the-image" class="header-anchor">#</a> Create a snapshot from the image</h2> <p>If you don’t want to modify the cloud image each time you create a VM, you can create a snapshot from the cloud image. The snapshot's virtual size can be different from the base image. In this example, we will use 20G instead of the base image's virtual size (10G). Cloud-init will grow the root filesystem automatically on the creation of the VM.</p> <div class="language-sh extra-class"><pre class="language-sh"><code>qemu-img create <span class="token parameter variable">-f</span> qcow2 <span class="token parameter variable">-b</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2 <span class="token parameter variable">-F</span> qcow2 wiki_example_almalinux92_snapshot.qcow2 20G
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you face a permission error on image, snapshot, and Cloud-init ISO files, you can resolve it in the following ways:</p> <ul><li>You can move the image and snapshot to the <code>/var/lib/libvirt/images</code> directory.</li> <li>Change the ownership of file to <code>qemu</code> user with <code>chown qemu:qemu</code>. On SELinux enforced systems, do not forget to change the context type too with <code>chcon -t virt_image_t</code></li></ul></div> <h2 id="cloud-init"><a href="#cloud-init" class="header-anchor">#</a> Cloud-init</h2> <p>The <a href="https://cloudinit.readthedocs.io/en/latest/reference/datasources/nocloud.html" target="_blank" rel="noopener noreferrer">NoCloud<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> datasource allows the user to provide <code>user-data</code>, <code>meta-data</code> and <code>network-config</code> to the VM without running a network service (or even without having a network at all). You can provide Meta-data and User-data files with <code>--cloud-init</code> option of <a href="https://virt-manager.org/" target="_blank" rel="noopener noreferrer">virt-install<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <code>&gt;= 3.0.0</code> or with an ISO file for versions `&lt; 3.0.0.</p> <p>The name of the default user on the AlmaLinux OS Generic Cloud images is <code>almalinux</code> and it's locked. Therefore we need to inject a password or public ssh key for authentication. In this example, we do both: set a password and add public SSH keys for the <code>almalinux</code> user.</p> <p>These two main criteria must be met on the Cloud-init User Data:</p> <ul><li>The first line must be <code>#cloud-config</code>.</li> <li>The syntax must be in <code>YAML</code>.</li></ul> <p><code>user-data:</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment">#cloud-config</span>

<span class="token key atrule">ssh_pwauth</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment"># sshd service will be configured to accept password authentication method</span>
<span class="token key atrule">password</span><span class="token punctuation">:</span> changeme <span class="token comment"># Set a password for almalinux</span>
<span class="token key atrule">chpasswd</span><span class="token punctuation">:</span>
    <span class="token key atrule">expire</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment"># Don't ask for password reset after the first log-in</span>
<span class="token key atrule">ssh_authorized_keys</span><span class="token punctuation">:</span> <span class="token comment"># Add your ssh public key for publickey authentication</span>
    <span class="token punctuation">-</span> ssh<span class="token punctuation">-</span>ed25519 AAAAB3NzaC1yc2EAAAABIwAAAQEA3I7VUf2l5gSn5uavROsc5HRDpZ turquoisekodkod@almalinux.example
    <span class="token punctuation">-</span> ssh<span class="token punctuation">-</span>rsa AAAAB3NzaC1yc2EAAAABIwAAAGEA3FSyQwBI6Z+nCSjUU sapphirecaracal@almalinux.example
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Refer to the Cloud-init modules <a href="https://cloudinit.readthedocs.io/en/latest/topics/modules.html#" target="_blank" rel="noopener noreferrer">list<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for further customization options.</p></div> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can close the console output of the VM with <code>Ctrl + ]</code></p></div> <p>Start the VM - <code>virt-install &gt;= 3.0.0</code> with <code>--cloud-init</code> option:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env bash</span>


<span class="token assign-left variable">vm_name</span><span class="token operator">=</span><span class="token string">'wiki-example-almalinux92'</span>
<span class="token assign-left variable">vm_memory</span><span class="token operator">=</span><span class="token string">'2048'</span>
<span class="token assign-left variable">vm_cpus</span><span class="token operator">=</span><span class="token string">'2'</span>
<span class="token assign-left variable">vm_disk</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/wiki_example_almalinux92_snapshot.qcow2'</span>

<span class="token assign-left variable">ci_user_data</span><span class="token operator">=</span><span class="token string">'ci_user_data_ssh_auth_pass_pubkey'</span>


virt-install <span class="token punctuation">\</span>
    <span class="token parameter variable">--connect</span> qemu:///system <span class="token punctuation">\</span>
    <span class="token parameter variable">--name</span> <span class="token string">&quot;<span class="token variable">$vm_name</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--memory</span> <span class="token string">&quot;<span class="token variable">$vm_memory</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--machine</span> q35 <span class="token punctuation">\</span>
    <span class="token parameter variable">--vcpus</span> <span class="token string">&quot;<span class="token variable">$vm_cpus</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--cpu</span> host-passthrough <span class="token punctuation">\</span>
    <span class="token parameter variable">--import</span> <span class="token punctuation">\</span>
    --cloud-init user-data<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ci_user_data</span>&quot;</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--osinfo</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>almalinux8 <span class="token punctuation">\</span>
    <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$vm_disk</span>&quot;</span> <span class="token punctuation">\</span>
    --virt-type kvm
</code></pre></div><p>Start the VM - <code>virt-install &lt; 3.0.0</code></p> <p>Create Cloud-init data ISO with User and Meta data files:</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The filename of Cloud-init user data, meta data must be renamed to <code>user-data</code> and <code>meta-data</code> and be placed on the root directory of ISO.</p></div> <div class="language-sh extra-class"><pre class="language-sh"><code>/user-data
/meta-data
</code></pre></div><p>The <code>meta-data</code> can be empty for no meta-data option</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> meta-data
</code></pre></div><p>xorriso (AlmaLinux OS 9)</p> <div class="language-sh extra-class"><pre class="language-sh"><code>xorriso <span class="token parameter variable">-as</span> genisoimage <span class="token parameter variable">-output</span> ci_data.iso <span class="token parameter variable">-volid</span> CIDATA <span class="token parameter variable">-joliet</span> <span class="token parameter variable">-rock</span> user-data meta-data
</code></pre></div><p>genisoimage (AlmaLinux OS 8)</p> <div class="language-sh extra-class"><pre class="language-sh"><code>genisoimage <span class="token parameter variable">-output</span> ci_data.iso <span class="token parameter variable">-volid</span> CIDATA <span class="token parameter variable">-joliet</span> <span class="token parameter variable">-rock</span> user-data meta-data
</code></pre></div><p>Create the VM with Cloud-init data ISO mounted:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token assign-left variable">vm_name</span><span class="token operator">=</span><span class="token string">'wiki-almalinux92'</span>
<span class="token assign-left variable">vm_memory</span><span class="token operator">=</span><span class="token string">'2048'</span>
<span class="token assign-left variable">vm_cpus</span><span class="token operator">=</span><span class="token string">'2'</span>
<span class="token assign-left variable">vm_disk</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/wiki_example_almalinux92_snapshot.qcow2'</span>

<span class="token assign-left variable">ci_dataiso</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/ci_data.iso'</span>

virt-install <span class="token punctuation">\</span>
     <span class="token parameter variable">--connect</span> qemu:///system <span class="token punctuation">\</span>
     <span class="token parameter variable">--name</span> <span class="token string">&quot;<span class="token variable">$vm_name</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--memory</span> <span class="token string">&quot;<span class="token variable">$vm_memory</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--machine</span> q35 <span class="token punctuation">\</span>
     <span class="token parameter variable">--vcpus</span> <span class="token variable">$vm_cpus</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--cpu</span> host-passthrough <span class="token punctuation">\</span>
     <span class="token parameter variable">--import</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--osinfo</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>almalinux9 <span class="token punctuation">\</span>
     <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$vm_disk</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$ci_dataiso</span>&quot;</span>,device<span class="token operator">=</span>cdrom <span class="token punctuation">\</span>
     --virt-type kvm
</code></pre></div><p>Get the IP address of the VM:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">virsh</span> domainifaddr <span class="token variable">$VM_NAME</span>
</code></pre></div><h2 id="static-ip"><a href="#static-ip" class="header-anchor">#</a> Static IP</h2> <p>To create a VM with static IPs rather than dynamic from DHCP, We need to create <code>network-config</code> file in  Networking config Version 1 or Networking config Version 2 format.</p> <p>An example for a single interface VM on <code>192.168.122.0/24</code> network, our <code>network-config</code> file would be:</p> <p>Networking config Version 1:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token key atrule">config</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> physical
    <span class="token key atrule">name</span><span class="token punctuation">:</span> eth0
    <span class="token key atrule">subnets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">type</span><span class="token punctuation">:</span> static
        <span class="token key atrule">address</span><span class="token punctuation">:</span> 192.168.122.92
        <span class="token key atrule">netmask</span><span class="token punctuation">:</span> 255.255.255.0
        <span class="token key atrule">gateway</span><span class="token punctuation">:</span> 192.168.122.1
        <span class="token key atrule">dns_nameservers</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> 192.168.122.1
          <span class="token punctuation">-</span> 9.9.9.9
</code></pre></div><p>Networking config Version 2:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">ethernets</span><span class="token punctuation">:</span>
  <span class="token key atrule">eth0</span><span class="token punctuation">:</span>
    <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> 192.168.122.92/24
    <span class="token key atrule">gateway4</span><span class="token punctuation">:</span> 192.168.124.1
    <span class="token key atrule">nameservers</span><span class="token punctuation">:</span>
      <span class="token key atrule">addresses</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 192.168.122.1
        <span class="token punctuation">-</span> 9.9.9.9
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Please consult documenation pages of <a href="https://cloudinit.readthedocs.io/en/latest/reference/network-config-format-v1.html" target="_blank" rel="noopener noreferrer">Networking config Version 1<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://cloudinit.readthedocs.io/en/latest/reference/network-config-format-v2.html" target="_blank" rel="noopener noreferrer">Networking config Version 2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for the full list of options.</p></div> <p>In virt-install/manager version <code>&gt;= 4.1.0</code> (available in AlmaLinux OS 9), you can use the <code>network-config</code> sub-option of the <code>--cloud-init</code> option.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token assign-left variable">vm_name</span><span class="token operator">=</span><span class="token string">'wiki-almalinux92'</span>
<span class="token assign-left variable">vm_memory</span><span class="token operator">=</span><span class="token string">'2048'</span>
<span class="token assign-left variable">vm_cpus</span><span class="token operator">=</span><span class="token string">'2'</span>
<span class="token assign-left variable">vm_disk</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/wiki_example_almalinux92_snapshot.qcow2'</span>

<span class="token assign-left variable">ci_user_data</span><span class="token operator">=</span><span class="token string">'ci_user_data_ssh_auth_pass_pubkey'</span> <span class="token comment"># Cloud-init user-data</span>
<span class="token assign-left variable">ci_network_config</span><span class="token operator">=</span><span class="token string">'ci_network_config_192_168_122_92_v1'</span> <span class="token comment"># Cloud-init network-config</span>


virt-install <span class="token punctuation">\</span>
     <span class="token parameter variable">--connect</span> qemu:///system <span class="token punctuation">\</span>
     <span class="token parameter variable">--name</span> <span class="token string">&quot;<span class="token variable">$vm_name</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--memory</span> <span class="token string">&quot;<span class="token variable">$vm_memory</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--machine</span> q35 <span class="token punctuation">\</span>
     <span class="token parameter variable">--vcpus</span> <span class="token string">&quot;<span class="token variable">$vm_cpus</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--cpu</span> host-passthrough <span class="token punctuation">\</span>
     <span class="token parameter variable">--import</span> <span class="token punctuation">\</span>
     --cloud-init user-data<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ci_user_data</span>&quot;</span>,network-config<span class="token operator">=</span><span class="token string">&quot;<span class="token variable">$ci_network_config</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--osinfo</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>almalinux9 <span class="token punctuation">\</span>
     <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$vm_disk</span>&quot;</span> <span class="token punctuation">\</span>
     --virt-type kvm
</code></pre></div><p>On virt-install/manager <code>&lt; 4.1.0</code> (AlmaLinux OS 8), you will need to create a Cloud-init Data ISO in ISO 9660 format.</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The names of Cloud-init user data, meta data and networking config must be renamed to <code>user-data</code>, <code>meta-data</code> and <code>network-config</code> and be present on the root directory of ISO.</p></div> <div class="language-sh extra-class"><pre class="language-sh"><code>/user-data
/meta-data
/network-config
</code></pre></div><p>Create the Cloud-init Data ISO:</p> <p>The <code>meta-data</code> file can be empty if no meta-data is needed.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">touch</span> meta-data
</code></pre></div><p>xorriso (AlmaLinux OS 9)</p> <div class="language-sh extra-class"><pre class="language-sh"><code>xorriso <span class="token parameter variable">-as</span> genisoimage <span class="token parameter variable">-output</span> ci_data.iso <span class="token parameter variable">-volid</span> CIDATA <span class="token parameter variable">-joliet</span> <span class="token parameter variable">-rock</span> user-data meta-data network-config
</code></pre></div><p>genisoimage (AlmaLinux OS 8)</p> <div class="language-sh extra-class"><pre class="language-sh"><code>genisoimage <span class="token parameter variable">-output</span> ci_data.iso <span class="token parameter variable">-volid</span> CIDATA <span class="token parameter variable">-joliet</span> <span class="token parameter variable">-rock</span> user-data meta-data network-config
</code></pre></div><p>Create the VM with Cloud-init data ISO mounted:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env bash</span>

<span class="token assign-left variable">vm_name</span><span class="token operator">=</span><span class="token string">'wiki-almalinux92'</span>
<span class="token assign-left variable">vm_memory</span><span class="token operator">=</span><span class="token string">'2048'</span>
<span class="token assign-left variable">vm_cpus</span><span class="token operator">=</span><span class="token string">'2'</span>
<span class="token assign-left variable">vm_disk</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/wiki_example_almalinux92_snapshot.qcow2'</span>

<span class="token assign-left variable">ci_dataiso</span><span class="token operator">=</span><span class="token string">'/var/lib/libvirt/images/ci_data.iso'</span>

virt-install <span class="token punctuation">\</span>
     <span class="token parameter variable">--connect</span> qemu:///system <span class="token punctuation">\</span>
     <span class="token parameter variable">--name</span> <span class="token string">&quot;<span class="token variable">$vm_name</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--memory</span> <span class="token string">&quot;<span class="token variable">$vm_memory</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--machine</span> q35 <span class="token punctuation">\</span>
     <span class="token parameter variable">--vcpus</span> <span class="token variable">$vm_cpus</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--cpu</span> host-passthrough <span class="token punctuation">\</span>
     <span class="token parameter variable">--import</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--osinfo</span> <span class="token assign-left variable">name</span><span class="token operator">=</span>almalinux9 <span class="token punctuation">\</span>
     <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$vm_disk</span>&quot;</span> <span class="token punctuation">\</span>
     <span class="token parameter variable">--disk</span> <span class="token string">&quot;<span class="token variable">$ci_dataiso</span>&quot;</span>,device<span class="token operator">=</span>cdrom <span class="token punctuation">\</span>
     --virt-type kvm
</code></pre></div><h2 id="virt-manager-gui"><a href="#virt-manager-gui" class="header-anchor">#</a> Virt-Manager (GUI)</h2> <p>Unlike the virt-install, the virt-manager doesn't have an option to provide Cloud-init <code>user-data</code>, <code>meta-data</code> and <code>network-config</code> (Static IP). For that reason we can add Cloud-init data ISO to our VM as CDROM device.</p> <p>&quot;New VM&quot; -&gt; &quot;Import existing disk image&quot; -&gt; Choose AlmaLinux OS image itself or snapshot, put a tick on the &quot;Customize configuration before install&quot; option.</p> <p>&quot;Add Hardware&quot; -&gt; &quot;Storage&quot; -&gt; Select Device type as &quot;CDROM&quot;, click on &quot;Manage&quot; and select Cloud-init data ISO and click on &quot;Finish&quot; button. Start the VM with the &quot;Begin Installation&quot;.</p> <h2 id="repackage-cloud-image"><a href="#repackage-cloud-image" class="header-anchor">#</a> Repackage cloud image</h2> <p>shutdown VM:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">sudo</span> <span class="token function">virsh</span> <span class="token function">shutdown</span> <span class="token variable">$VM_NAME</span>
</code></pre></div><p>Convert the snapshot to the full image without touching backing file(<code>AlmaLinux-8-GenericCloud-8.4-20210616.x86_64.qcow2</code>):</p> <div class="language-sh extra-class"><pre class="language-sh"><code>qemu-img convert <span class="token parameter variable">-c</span> <span class="token parameter variable">-O</span> qcow2 doc-almalinux84-snapshot.qcow2 doc-almalinux84-base.qcow2
</code></pre></div><p>You can reset, unconfigure and inject files to the image with <code>libguestfs virt-sysprep</code>. See the upstream documentation for further <a href="https://libguestfs.org/virt-sysprep.1.html#options" target="_blank" rel="noopener noreferrer">option<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://libguestfs.org/virt-sysprep.1.html#operations" target="_blank" rel="noopener noreferrer">operations.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-sh extra-class"><pre class="language-sh"><code>virt-sysprep <span class="token parameter variable">--format</span> qcow2 <span class="token parameter variable">-a</span> doc-almalinux84-base.qcow2
</code></pre></div><h2 id="inspection-and-manipulation-of-images"><a href="#inspection-and-manipulation-of-images" class="header-anchor">#</a> Inspection and Manipulation of images</h2> <p>Show a file inside the image</p> <div class="language-sh extra-class"><pre class="language-sh"><code>virt-cat <span class="token parameter variable">-a</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2 /etc/cloud/cloud.cfg
</code></pre></div><p>Show disk usage inside the image</p> <div class="language-sh extra-class"><pre class="language-sh"><code>virt-df <span class="token parameter variable">-a</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2 <span class="token parameter variable">-h</span>
</code></pre></div><p>Display the OS infromation</p> <div class="language-sh extra-class"><pre class="language-sh"><code>virt-inspector <span class="token parameter variable">-a</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2
</code></pre></div><p>Get the version of <code>kernel</code> package with the help of XPATH query</p> <div class="language-sh extra-class"><pre class="language-sh"><code>virt-inspector <span class="token parameter variable">-a</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2 <span class="token operator">|</span> virt-inspector <span class="token parameter variable">--xpath</span> <span class="token string">'//application[name=&quot;kernel&quot;]/version | //application[name=&quot;kernel&quot;]/release'</span>

<span class="token operator">&lt;</span>version<span class="token operator">&gt;</span><span class="token number">5.14</span>.<span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/version<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>release<span class="token operator">&gt;</span><span class="token number">284.11</span>.1.el9_<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/release<span class="token operator">&gt;</span>
</code></pre></div><p>Mount filesystems of an image.</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> guest_mount <span class="token comment"># Create the mount directoy</span>
guestmount <span class="token parameter variable">-a</span> AlmaLinux-9-GenericCloud-9.2-20230513.x86_64.qcow2 <span class="token parameter variable">-i</span> <span class="token parameter variable">--ro</span> guest_mount/ <span class="token comment"># Mount read-only with --ro</span>
guestunmount guest-mount/ <span class="token comment"># Unmount</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>You can check the <a href="https://www.libguestfs.org" target="_blank" rel="noopener noreferrer">libguestfs's website<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for more documentation and more tools</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/cloud/Generic-cloud.html" class="prev">
        Generic Cloud (cloud-init)
      </a></span> <span class="next"><a href="/cloud/Google.html">
        Google Cloud
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7857f0f2.js" defer></script><script src="/assets/js/2.592a6313.js" defer></script><script src="/assets/js/1.47e12c88.js" defer></script><script src="/assets/js/35.9e9a06e2.js" defer></script>
  </body>
</html>
